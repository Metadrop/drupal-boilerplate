# Metadrop's Drupal Boilerplate

## Introduction

This repository is a boilerplate to create Drupal 8/9/10 projects with many tools already preconfigured with minimal effort.

Tools included out-of-the-box:

  - A docker infrastructure.
  - A boilerplate folder structure that fits all project needs.
  - A working and preconfigured Drush, the Drupal shell.
  - MkDocs to document your project using Markdown files.
  - Grumphp to enforce [Drupal coding standards](https://www.drupal.org/docs/develop/standards/coding-standards). It is configured to use [phplint](https://github.com/overtrue/phplint), yamlint,  [jsonlint](https://github.com/Seldaek/jsonlint), [drupalcheck](https://github.com/mglaman/drupal-check), [phpcpd](https://github.com/sebastianbergmann/phpcpd) and [phpcs](https://github.com/squizlabs/PHP_CodeSniffer).
  - Phpqa for static analysis.
  - Behat BDD testing configured and working.
  - PHPUnit for unit testing configured and working.
  - [BackstopJS](https://github.com/garris/BackstopJS) for visual regression testing.
  - [Stylelint](https://stylelint.io/) for checking style files.
  - [Scripthor](https://github.com/Metadrop/scripthor) toolset with some helper scripts for development.
  - Optionally, a Solr container ready to be used by Drupal.



It is based on [Docker4Drupal](https://wodby.com/docs/1.0/stacks/drupal/local/), which uses Docker and Docker Compose. To get all the information about available webservers, databases, PHP versions and other containers check their [wodby/docker4drupa repository](https://github.com/wodby/docker4drupal).

Because it uses Docker under the hood, you can customize whatever you want, add new containers or use any standard Docker funcionality to accomodate your project needs.

## Quickview
![Create project](./create-project.gif)


## Usage

To create a new project based on this boilerplate, the recommended method is using Composer's create-project command:

```
composer create-project  --ignore-platform-reqs metadrop/drupal-boilerplate my-project
```


Once Composer finalizes the project creation an assistant will be autmatically run. It will ask you a few questions:

 - The project name: this a machine name for the project. It will be used for Docker container names, project URL and some other places. Please, use only letters, numbers and underscores.

 - Setup a git repository? If yes, the assistant will initialize a git repository and make the initial commit.

 - Install Drupal? If thes, the assistan will configure and install a Drupal site.

 - Radix sub-theme: the asistant can create a [Radix](https://www.drupal.org/project/radix) subtheme for you. We quite often use Radix as the base theme of our projects. You can skip this and use your own theme, of course.


After the assistant finished, if you have selected to install Drupal your project will be running and the assitant will print the URL to access it.


## Included out-of-the-box

### docker-compose infrastructure


### Drupal project folder structure

#### Drupal settings

Drupal settings for all environments are placed in the `settings.php` file. This file includes a `settings.local.php` if it exists. This local settings file should include any configuration dependent from the environment such the database connection settings.








### Scripthor toolset

[Scripthor](https://github.com/Metadrop/scripthor) is our set of scripts for our daily routine, to speed up the development workflow.

Til today, we provide the following scripts:
- **reload-local.sh**: Reload your local environment setting everything up for a new developer, a new branch, or just
  to ensure your changes won't break production during the deployment.
- **frontend-build.sh**: Compile your sass and js-es6 files inside docker so you don't need to have node or gulp
  installed on your machine. Forget about version issues.
- **copy-content-config-entity-to-module.sh**: For a given content entity (content type, paragraph, custom block type...)
  it will take the entity definition, all its fields, form configuration and view modes and will copy them to the module of
  your choice.
- **backup.sh**: Perform a full backup of the site, db and files.
- **setup-traefik-port.sh** Get the port generated by trefik and bulk it on .env.
- **update-helper.sh** Allows to update and commit drupal modules and dependencies.
- **solr-sync.sh** Reload docker solr cores from local files.

### Solr


Although the Solr container is not enabled by default, some commands to manage the Solr server are provided.

  - Core configuration sync: recreates the Solr core using the core configuration files from project.

    ```
    make solr-sync:
    ```

 -  Rebuild Solr server: sometimes Solr server needs to be completely recreated. This means completely delete and recreate the container and associated a data, a run the core configuration sync task to recreate the cores as well. To do so, run the following command:

    ```
    make solr-rebuild
    ```


### Backstopjs

[BackstopJS](https://github.com/garris/BackstopJS) automates visual regression testing of your responsive web UI by comparing DOM screenshots over time.

* [Documentation](https://github.com/garris/BackstopJS#using-backstopjs)

* Generate references:

      make backstopjs-reference

* Run regressions tests:

      make backstopjs-test

### Buffet of selected modules

We are updating or selection of required modules to ensure you won't forget anything. The modules bundled will solve the needs of different areas such as SEO, security, content editing, themming or deployments across different environments.

## Manual configuration

If you didn't allow the assistant to autoconfigure the project or do want to know which steps are needed this is list is for you:

Steps to configure the project:

1. Copy the `.env.example` file to `.env` and edit it to fit your needs.
1. Copy the `docker-compose.override.yml.dist` file to `docker-compose.override.yml`. Look for the
services.traefik.ports value. There you have the port mapping in the form `<your local machine port>:<container port>`.
Note that WEB_SERVER_PORT is the local machine port which is mapped to point the web server port inside the container.
1. Start containers running `docker-compose up -d` in repository root.
1. To access the site go to URL: http://\<PROJECT_BASE_URL\>:\<WEBSERVER_PORT\>/
1. To access the project's documentation go to URL: http://docs.\<PROJECT_BASE_URL\>:\<WEBSERVER_PORT\>/
1. (Optional) In the case you need access to remote environments inside PHP container, uncomment these lines at docker-compose.override.yml:
```yaml
#  php:
#    environment:
#      SSH_AUTH_SOCK: /ssh-agent
...
#    volumes:
#      - $SSH_AUTH_SOCK:/ssh-agent
```


## Additions from Docker4Drupal

### `.env` file

Added several variables:


@TODO:
 - DOCKER_PROJECT_ROOT:
 - THEME_PATH:
 - NPM_RUN_COMMAND:
 - DEFAULT_DRUSH_ALIAS:

[Test link to deploy](docs/docs/deploy.md)
[Test link tu subpage](docs/docs/others/mkdocs.md)


